# architecture-medikamente

## [Задание 1. Анализ безопасности системы](https://github.com/Boropwnz/architecture-medikamente/tree/medikamente/Task1)

<details>
  
<summary>Решение</summary>

Чтобы заниматься реализацией новых продуктов, которые основаны на данных, необходимо системно решить проблему хранения конфиденциальных данных и управления ими.
Сейчас данные лежат в непосредственной близости к пользователям, поэтому существует риск утечки данных и неправомерного использования информации.
Чтобы защитить данные, используйте механизмы, инструменты и принципы работы с конфиденциальными данными, например, подходы Privacy By Design, Data Minimization и Data Lineage.
В рамках этого задания вам нужно проанализировать состояние As-Is, чтобы впоследствии приступить к его доработке.

### Выявите конфиденциальные данные, которые не учтены во внутренних системах.
Можно выделить следующие группы конфиденциальных данных, участвующих в работе компании:
- Общие персональные данные клиентов (PII): ФИО, дата рождения, контактная информация, общие сведения о состоянии здоровья.
- Медицинские данные клиентов (PHI): истории болезней, результаты анализов и исследований, диагнозы и назначения препаратов.
- Финансовые данные клиентов: реквизиты счетов, данные карт, платежные документы, суммы оплаты.
- Внутренние данные компании: документооборот с потавщиками товаров и услуг, информация о закупках.
- Персональные данные сотрудников: ФИО, дата рождения, паспортные данные, начисления зарплаты, информация об отпусках.

Диаграммы потоков данных (Data Flow Diagrams):
[DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD.drawio)
![DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD.svg)


### Проведите аудит мер по обеспечению безопасности данных.

Список проблем:
- Нет защиты от утери или утечки: нет безопасного шифрования данных при хранении, передаче и использовании.
- Нет контроля доступа: нет системы ролей или атрибутов для управления правами доступа к данным, а так же алертинга при инцидентах.
- Нет безопасной передачи между бизнес слоями: нет механизмов обсфуркации, маскриовки, токенизации и обезличивания персональных/платежных данных.
- Нет политик минимизации количества собираемых данных Data Minimization, отслеживания их истории Data Lineage, своевременного удаления.
- Нет надежного архивирования и резервного копирования.
- Нет соблюдения законов о персональных данных.
- Нет автоматического управления жизненным циклом данных и правами пользователей.
- Нет системы регулярных аудитов, проверок, обучения и актуализации принятых политик.
- Нет классификации и тегирования данных.


### Подумайте, что можно улучшить.

Способы защиты данных:

| Данные | Способ защиты |
|-----|------------------------------------|
| PII клиентов | шифрование (AES-256) при хранении и передаче (TLS), доступ по ролям, обфускация данных паспорта, контактов, маскирование в зависимости от прав роли |
| PHI клиентов | шифрование (AES-256) при хранении и передаче (TLS), обезличивание, токенизация, доступ по ролям |
| Финансовые и платежные документы | шифрование (AES-256) при хранении и передаче (TLS), обфускация, токенизация, доступ по ролям |
| Внутренние данные компании | шифрование (AES-256) при хранении и передаче (TLS), токенизация, доступ по ролям |
| Персональные данные сотрудников | шифрование (AES-256) при хранении и передаче (TLS), доступ по ролям |

Механизм тегирования данных можно начать разрабатывать с использованием инструментов тегирования имеющихся в компетенциях технического директора, например, в терминах Postgress или ClickHouse (поддерживают тегирование).
Автоматический поиск и тегирование данных и мониторинг тегов можно реализовать при помощи BigID. Судя по описанию оно хорошо подходит для работы с медицинскими данными. Имеет свои возможности DLP или можно интегрировать сторонние.


Тегирование нужно сделать по степени конфиденциальности и правам доступа:
 - `PUB`-публичные
 - `PII`-персональные
 - `PHI`-медицинские
 - `INT`-внутренние
 - `FIN`-финансовые

По целям для применения автоматических сценариев:
 - `ENC`-шифровать
 - `BKP`-делать резервную копию
 - `EXT`-передать во внешнюю систему, подготовить
 - `DEL`-удалить
 - `PRC`-преобразовать
 - и т. д.

Контроль доступа на основе ролей и атрибутов может быть интегрирован из Keycloak.

BigID имеет свой SOAR в качетсве SIEM для оркестрации событий безопасности.

Нужно отдельно изучить соответствие BigID требованиям законодательства к хранению и обработке медицинской информации и персональных данных. Судя по описанию Medikamente имеет амбициозные планы и ресурсы для инвестирования в развитие, а BigID видится комплексным решением закрывающим все вопросы управления данными и их безопасностью.

Настроить поиск данных, мониторинг, визуализацию и логирование можно про помощи Elastic Stack, который входит в компетенции технического директора.

Нужно настроить алертинг на случай попыток несанкционрованного доступа и подозрительной активности.

Нужно настроить истечение срока прав доступа.

Нужно обеспечить резервное копирование данных.

Данные должны храниться изолированно в обезличенной форме. Фрагмент данных определенного контекства может собрать по ключам и идентификаторам только тот, у кого есть к ним доступ и права.

Например, схематично:
 - Результаты анализов хранятся указывая только на идентификатор клиента
 - Врач имеет доступ к результатам анализов только своих клиентов
 - Врач знает идентификатор только своего клиента
 - Врач имеет доступ к валидному ключу для дешифровки данных только в свою смену
 - Сопоставив идентификаторы, ключи и права доступа, врач получит только фрагмент данных о клиенте - только результаты анализов

</details>

## [Задание 2. Проектирование решения](https://github.com/Boropwnz/architecture-medikamente/tree/medikamente/Task2)

<details>
  
<summary>Решение</summary>

Используя подход Privacy by Design, проведите анализ и предложите механизмы для предупреждения возможных рисков, связанных с конфиденциальностью. Ваша задача — спроектировать механизмы управления такими рисками до момента реализации изменений в проектируемой системе.
В рамках этого задания вам нужно проанализировать состояние As-Is и оценить, как спроектировать решение с учётом требований To-Be.

### Предложить новые блоки в архитектуру проектируемой системе С4, которые обеспечат соблюдение принципов Privacy By Design во многих блоках реализуемой системы.
Предложения:
- Помимо API Gateway для клиентов и ресепшионистов предлагается сделать B2B API для внешних подрядчиков. API принципиально разные, имеют разную нагрузку не будет одной точки отказа. API подрядчика будет оперировать терминами бизнес контрактов, клиент - терминами своих медицинских запросов. Запросы клиентов к внешним подрядчикам транслируются в логику бизнес-запроса в отдельном сервисе.
- Вводится система прав и ролей пользователей для авторизации (keycloak).
- Вводится система управления данными и их безопасностью (BigID) для тегирования, мониторинга и управления потоками данных, а так же оповещения об инцедентах и запуска автоматических сценариев обработки данных.
- Будем иметь разделение данных на контектсы: медецинские данные клиентов, данные для учета/бухгалтерии и обезличенные данные для анализа.
- Данные для анализа хранятся в Data Lakehouse, туда они попадают из всех систем предварительно пройдя обезличивание и никак не могут идентифицировать источник.
- Данные хранятся только в зашифрованном виде. Ключи даются только тому, кому эти данные принадлежат или кто с ними работает непосредственно в данный момент по разрешению. Пример 1: пользователь может получить доступ к своим данным всегда по идентификатору и ключу. Пример 2: врач может получить доступ к медицинским данным пользователя только если работает (авторизован), принимет клиента (предоставлен идентификатор) и пользователь ему разрешил (дал согласие на обработку при записи к врачу).
- Будем иметь службу мониторинга попыток доступа, логирование и алертинг при попытке несанкционированного доступа.
- Склад и бухгалтерия вообще не имеют отношения и доступа к медицинским данным, у них свои базы данных или таблицы. Данные для анализа они отправляют в Data Lakehouse также в обезличенном виде.
- CRM хранит только те данные, которые нужны для работы. Доступ разграничен по ролям, данные обсфурцированы.
- Пользователь через личный кабинет может удалить или изменить свои данные или запросить удаление медицинской карты и истории (если законодательство разрешает).

### Предложить в целевой архитектуре слой, который обеспечивает аналитическую работу с данными системы с учётом принципов Privacy by Design.
Предложения:
- Хранить данные в Data Lakehouse, так как имеются как структурированные данные, так и нет. Помимо исследований требуются также данные для отчетов и инсайтов.
- Данные могут храниться в трех различных контекстах изолировано: медицинские данные пациентов, данные для бухгалтерии и учета, данные для исследований. Это может быть и одно хранилище, но физически данные должны быть разделены.
- Доступ разграничен по контекстам, правам и ролям.
- Данные для исследований отправляются в Lakehouse через процедуру обезличивания.
- Данные истории и архива бухгалтерии, склада и CRM могут храниться в Warehouse части Data Lakehouse для удобства, но доступ должен быть ограничен.

Диаграмма контекста C4 целевого состояния системы:
[context.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task2/context.drawio)
![context.svg](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task2/context.svg)

</details>

## [Задание 3. Оценка Data Encryption at Rest and In Transit](https://github.com/Boropwnz/architecture-medikamente/tree/medikamente/Task3)

<details>
  
<summary>Решение</summary>

Вам необходимо разработать стратегию защиты данных в рамках всей системы. При этом важно учесть особенности шифрования данных, которые находятся в разных состояниях — при хранении и во время передачи. 

### Определить, какие данные нужно защитить. 
Классификация информации для выбора наиболее эффективные методы защиты.
По состоянию:
- В покое
- В транзите

По чувствительности, профилю риска и другим параметрам:
- PII общие
- PII контакты (физическая бкзопасность)
- PII документы (финансовая безопасность)
- PHI
- Финансовые
- Внутренние
- Секретные

### Реализовать базовые инструменты защиты.
Предлагаются следующие инструменты защиты, которые нужно добавить в систему:
- шифрование в покое и при передаче
- разделение доступа по ролями и правам
- алертинг
- токенизация и обезличивание

### Использовать автоматизированный контроль.
Предлагаются следующие средства для контроля за данными: BigID для комплексного управления жизненным циклом данных, автоматического тегирования, алертинга (SOAR) и отработки автоматических сценариев/событий/действий над данными.

### Подготовить реестр программных и аппаратных средств для защиты данных.
Классификация данных и обоснование необходимости защиты выделенных классов и инструменты защиты данных:

| Данные | В чём необходимость защиты | Инструменты защиты |
|-----|------------------------------------|--------------|
| PII общие (ФИО, дата рождения) | Утечка приведет к юридическим и репутационным издержкам | AES-256 шифрование в покое, TLS 1.3 при передаче |
| PII контакты (телефон, адрес) | Утечка приведет к серьезным юридическим и репутационным издержкам, угроза физической безопасности | AES-256 шифрование в покое, TLS 1.3 при передаче, обсфуркация и маскировка, обезличивание, ограничение доступа, алертинг |
| PII документы (паспорт, полис) | Утечка приведет к серьезным юридическим и репутационным издержкам, угроза финансовой безопасности | AES-256 шифрование в покое, TLS 1.3 при передаче, обсфуркация и маскировка, обезличивание, ограничение доступа, алертинг |
| PHI | Утечка приведет к серьезным юридическим и репутационным издержкам, уголовная ответственность | AES-256 шифрование в покое, TLS 1.3 при передаче, обсфуркация и маскировка, обезличивание, ограничение доступа, алертинг |
| Финансовые и платежные данные | Утечка приведет к юридическим и репутационным издержкам, угроза финансовой безопасности | AES-256 шифрование в покое, TLS 1.3 при передаче, обсфуркация и маскировка, ограничение доступа, алертинг |
| Внутренние данные, документы | Утечка приведет потере конкурентного преимущества и финансовым издержкам | AES-256 шифрование в покое, TLS 1.3 при передаче, токенизация и маскирока, ограничение доступа, алертинг  |
| Секретные данные, ключи | Минимизировать риски атаки извне и изнутри | Мониторинг подозрительной активности и алертинг, ротация ключей, минимальный набор прав доступа, ограниченный срок действия прав, регулярный аудит |

</details>

## [Задание 4. Оценка узких мест при миграции](https://github.com/Boropwnz/architecture-medikamente/tree/medikamente/Task4)

<details>
  
<summary>Решение</summary>

В компании планируется миграция устаревшей монолитной системы на современную архитектуру (например, на микросервисную). В процессе перехода необходимо выявить потенциально узкие места, которые могут негативно повлиять на работоспособность нового решения.

### Проанализировать ситуацию.
Ключевые процессы и компоненты, затрагиваемые миграцией:
- базы данных: переход от файлов к распределенным базам данных
- сервисы: переход от файлов к приложениям (разработка + обучение персонала)
- серверное оборудование: переход от одного сервера к распределенным решениям
- бизнес-логика: добавятся слои аналитики и учета
- компетенции: потребуются новые компетенции (DevOps, BigID, kafka-redis-kubernetes)
- авторизация: потребуется ведение аккаунтов и настройка прав
- отношение к информации: потребуется обучение сотрудников концепциям data privacy
- новые коммуникации и роли: создается полноценный отдел разработки
- новая структура работы с данными


### Выделить основные категории и для каждой указать возможные проблемы.
"Аппаратное обеспечение"
- нужно исследовать рынок предложений для облачных решений в т.ч. для данных которые нельзя хранить в публичных облаках
- нужны серьезные инвестиции в компьютеры для сотрудников, разработчиков и серверов
  
"Программное обеспечение"
- потребуется создать полноценный отдел разработки
- потребуется детально проработать архитектуру не только MVP, но и конечного решения
- нужно изучить рынок и законодательство для выбора оптимальных доступных программных решений
- потребуются инвестиции в офисное и прикладное ПО

"Персонал"
- нужно спланировать и значительно расширить штат разработчиков, системных администраторов, тестировщиков и специалистов поддержки
- нужно обучить персонал работе с новыми системами и программами

"Процессы"
- нужно обеспечить соответствие законодательству
- нужно вводить CI/CD сразу
- нужно настраивать и вводить разделение доступа по правам и ролям
- нужно внедрять Privacy by design обучением сотрудников
- нужно внедрять политику аудита информационной безопасности

"Интеграции"
- нужно спланировать постепенный переход от старых решений к новым
- нужно проектировать внешний API под цели бизнеса привлекать внешних подрядчиков + подключить к нему лабораторию
- нужно гармонично вписать имеющиюся схему работы бухгалтерии и склада в новое решение
- слишком много изменений, высокая нагрузка на организацию, сложно будет за всем уследить

### Построить диаграмму Исикавы.
Диаграмма «Рыбья кость» (Ishikawa):
[Ishikawa.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task4/Ishikawa.drawio)
![Ishikawa.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task4/Ishikawa.svg)

### Предложить рекомендации.
Список первостепенных мер непосредственно влияющих на остальные аспекты:
- Изучить юридические вопросы и ограничить технологический радар протоколами, инструментами, СУБД, технологиями, платформами и решениями, допустимыми к использованию в сфере медицины и для обработки чувствительных персональных данных.
  Составить документ требований законодательства к процессам, программному и аппаратному обеспечению.
- Изучить рынок аппаратного и программного обеспечений, доступность ЦОД и инфраструктуры. Составить грубые сметы различных вариантов реализации своих аппаратных и/или арендованых облачных решений.


Краткий список мер по устранению узких мест на основе диаграммы в порядке приорита:
| Приоритет | Категория | Проблема | Список мер |
|--|--|--|--|
| 1 | Процессы | Соответствие законодательству и информационная безопасность| Минимизировать обработку персональных данных, обеспечить базовую безопасность: настроить права и ограничить доступ, организовать шифрование. Это прямая задача от бизнеса. |
| 2 | Интеграция | Сложность миграции | Изучить законодательство и рынок чтобы иметь большее понимание доступных технических решений и принимать оптимальное решение. Смена парадигмы хранения данных - прямая задача от бизнеса. |
| 3 | Программное обеспечение | Нужно нанимать много разработчиков, нужно понимать каких именно нанимать | Изучить рынок решений, определить целесообразность использования конкретных технологий и самостоятельной разработки решений. |
| 4 | Аппаратное обеспечение | Может потребовать очень больших инвестиций | Изучить рынок решений, определить оптимальный вариант покупки или аренды вычислительных мощностей и облачных решений. |
| 5 | Программное обеспечение | Сложная миграция, новая система разрабатывается с нуля | Прямой запрос на MVP от бизнеса это сделать сервис записи и уведомлений, ввести роли, разделить данные на категории. Срок - несколько месяцев, поэтому нужно начать разрабатывать прототип сразу. Так же начинаем делать API для лаборатории. |
| 6 | Персонал | Нужно нанимать и обучать много специалистов | Нужно начать нанимать ключевых специалистов заранее чтобы они могли делиться экспертным мнением и входить в курс дела. |
| 7 | Процессы | Вводить CI/CD | DevOps будут нужны при любом стеке, стоит расширять их штат сразу, чтобы они готовили почву разработчикам и настраивали алертинг, ПО, права, рабочие места и процессы новым сотрудникам. |
| 8 | Персонал, процессы | BI/ML капабилити, сложность миграции | Нужно будет строить систему с нуля, от сервисов, до Data Lakehouse хранилищ, поэтому, стоит заранее искать специалистов. |
| 9 | Процессы | Сложность миграции, поддерживаемость | Работы впереди много, многому нужно будет научиться всем и система будет расширяться - нужно вести документацию с самого начала, это обеспечить пподдерживаемость и преемственность. Кроме того это прямой запрос от бизнеса. |

</details>
