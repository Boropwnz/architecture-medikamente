## Задание 2. Проектирование решения

Используя подход Privacy by Design, проведите анализ и предложите механизмы для предупреждения возможных рисков, связанных с конфиденциальностью. Ваша задача — спроектировать механизмы управления такими рисками до момента реализации изменений в проектируемой системе.
В рамках этого задания вам нужно проанализировать состояние As-Is и оценить, как спроектировать решение с учётом требований To-Be.

### Предложить новые блоки в архитектуру проектируемой системе С4, которые обеспечат соблюдение принципов Privacy By Design во многих блоках реализуемой системы.
Предложения:
- Помимо API Gateway для клиентов и ресепшионистов предлагается сделать B2B API для внешних подрядчиков. API принципиально разные, имеют разную нагрузку не будет одной точки отказа. API подрядчика будет оперировать терминами бизнес контрактов, клиент - терминами своих медицинских запросов. Запросы клиентов к внешним подрядчикам транслируются в логику бизнес-запроса в отдельном сервисе.
- Вводится система прав и ролей пользователей для авторизации (keycloak).
- Вводится система управления данными и их безопасностью (BigID) для тегирования, мониторинга и управления потоками данных, а так же оповещения об инцедентах и запуска автоматических сценариев обработки данных.
- Будем иметь разделение данных на контектсы: медецинские данные клиентов, данные для учета/бухгалтерии и обезличенные данные для анализа.
- Данные для анализа хранятся в Data Lakehouse, туда они попадают из всех систем предварительно пройдя обезличивание и никак не могут идентифицировать источник.
- Данные хранятся только в зашифрованном виде. Ключи даются только тому, кому эти данные принадлежат или кто с ними работает непосредственно в данный момент по разрешению. Пример 1: пользователь может получить доступ к своим данным всегда по идентификатору и ключу. Пример 2: врач может получить доступ к медицинским данным пользователя только если работает (авторизован), принимет клиента (предоставлен идентификатор) и пользователь ему разрешил (дал согласие на обработку при записи к врачу).
- Будем иметь службу мониторинга попыток доступа, логирование и алертинг при попытке несанкционированного доступа.
- Склад и бухгалтерия вообще не имеют отношения и доступа к медицинским данным, у них свои базы данных или таблицы. Данные для анализа они отправляют в Data Lakehouse также в обезличенном виде.
- CRM хранит только те данные, которые нужны для работы. Доступ разграничен по ролям, данные обсфурцированы.
- Пользователь через личный кабинет может удалить или изменить свои данные или запросить удаление медицинской карты и истории (если законодательство разрешает).

### Предложить в целевой архитектуре слой, который обеспечивает аналитическую работу с данными системы с учётом принципов Privacy by Design.
Предложения:
- Хранить данные в Data Lakehouse, так как имеются как структурированные данные, так и нет. Помимо исследований требуются также данные для отчетов и инсайтов.
- Данные могут храниться в трех различных контекстах изолировано: медицинские данные пациентов, данные для бухгалтерии и учета, данные для исследований. Это может быть и одно хранилище, но физически данные должны быть разделены.
- Доступ разграничен по контекстам, правам и ролям.
- Данные для исследований отправляются в Lakehouse через процедуру обезличивания.
- Данные истории и архива бухгалтерии, склада и CRM могут храниться в Warehouse части Data Lakehouse для удобства, но доступ должен быть ограничен.

Диаграмма контекста C4 целевого состояния системы:
[context.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task2/context.drawio)
![context.svg](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task2/context.svg)
