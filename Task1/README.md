## Задание 1. Анализ безопасности системы

Чтобы заниматься реализацией новых продуктов, которые основаны на данных, необходимо системно решить проблему хранения конфиденциальных данных и управления ими.
Сейчас данные лежат в непосредственной близости к пользователям, поэтому существует риск утечки данных и неправомерного использования информации.
Чтобы защитить данные, используйте механизмы, инструменты и принципы работы с конфиденциальными данными, например, подходы Privacy By Design, Data Minimization и Data Lineage.
В рамках этого задания вам нужно проанализировать состояние As-Is, чтобы впоследствии приступить к его доработке.

### Выявите конфиденциальные данные, которые не учтены во внутренних системах.
Можно выделить следующие группы конфиденциальных данных, участвующих в работе компании:
- Общие персональные данные клиентов (PII): ФИО, дата рождения, контактная информация, общие сведения о состоянии здоровья.
- Медицинские данные клиентов (PHI): истории болезней, результаты анализов и исследований, диагнозы и назначения препаратов.
- Финансовые данные клиентов: реквизиты счетов, данные карт, платежные документы, суммы оплаты.
- Внутренние данные компании: документооборот с потавщиками товаров и услуг, информация о закупках.
- Персональные данные сотрудников: ФИО, дата рождения, паспортные данные, начисления зарплаты, информация об отпусках.

Диаграммы потоков данных (Data Flow Diagrams):
[DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD.drawio)
![DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD.svg)


### Проведите аудит мер по обеспечению безопасности данных.

Список проблем:
- Нет защиты от утери или утечки: нет безопасного шифрования данных при хранении, передаче и использовании.
- Нет контроля доступа: нет системы ролей или атрибутов для управления правами доступа к данным, а так же алертинга при инцидентах.
- Нет безопасной передачи между бизнес слоями: нет механизмов обсфуркации, маскриовки, токенизации и обезличивания персональных/платежных данных.
- Нет политик минимизации количества собираемых данных Data Minimization, отслеживания их истории Data Lineage, своевременного удаления.
- Нет надежного архивирования и резервного копирования.
- Нет соблюдения законов о персональных данных.
- Нет автоматического управления жизненным циклом данных и правами пользователей.
- Нет системы регулярных аудитов, проверок, обучения и актуализации принятых политик.
- Нет классификации и тегирования данных.


### Подумайте, что можно улучшить.

Способы защиты данных:

| Данные | Способ защиты |
|-----|------------------------------------|
| PII клиентов | шифрование (AES-256) при хранении и передаче (TLS), доступ по ролям, обфускация данных паспорта, контактов, маскирование в зависимости от прав роли |
| PHI клиентов | шифрование (AES-256) при хранении и передаче (TLS), обезличивание, токенизация, доступ по ролям |
| Финансовые и платежные документы | шифрование (AES-256) при хранении и передаче (TLS), обфускация, токенизация, доступ по ролям |
| Внутренние данные компании | шифрование (AES-256) при хранении и передаче (TLS), токенизация, доступ по ролям |
| Персональные данные сотрудников | шифрование (AES-256) при хранении и передаче (TLS), доступ по ролям |

Механизм тегирования данных можно начать разрабатывать с использованием инструментов тегирования имеющихся в компетенциях технического директора, например, в терминах Postgress или ClickHouse (поддерживают тегирование).
Автоматический поиск и тегирование данных и мониторинг тегов можно реализовать при помощи BigID. Судя по описанию оно хорошо подходит для работы с медицинскими данными. Имеет свои возможности DLP или можно интегрировать сторонние.


Тегирование нужно сделать по степени конфиденциальности и правам доступа:
 - `PUB`-публичные
 - `PII`-персональные
 - `PHI`-медицинские
 - `INT`-внутренние
 - `FIN`-финансовые

По целям для применения автоматических сценариев:
 - `ENC`-шифровать
 - `BKP`-делать резервную копию
 - `EXT`-передать во внешнюю систему, подготовить
 - `DEL`-удалить
 - `PRC`-преобразовать
 - и т. д.

Контроль доступа на основе ролей и атрибутов может быть интегрирован из Keycloak.

BigID имеет свой SOAR в качетсве SIEM для оркестрации событий безопасности.

Нужно отдельно изучить соответствие BigID требованиям законодательства к хранению и обработке медицинской информации и персональных данных. Судя по описанию Medikamente имеет амбициозные планы и ресурсы для инвестирования в развитие, а BigID видится комплексным решением закрывающим все вопросы управления данными и их безопасностью.

Настроить поиск данных, мониторинг, визуализацию и логирование можно про помощи Elastic Stack, который входит в компетенции технического директора.

Нужно настроить алертинг на случай попыток несанкционрованного доступа и подозрительной активности.

Нужно настроить истечение срока прав доступа.

Нужно обеспечить резервное копирование данных.

Данные должны храниться изолированно в обезличенной форме. Фрагмент данных определенного контекства может собрать по ключам и идентификаторам только тот, у кого есть к ним доступ и права.

Например, схематично:
 - Результаты анализов хранятся указывая только на идентификатор клиента
 - Врач имеет доступ к результатам анализов только своих клиентов
 - Врач знает идентификатор только своего клиента
 - Врач имеет доступ к валидному ключу для дешифровки данных только в свою смену
 - Сопоставив идентификаторы, ключи и права доступа, врач получит только фрагмент данных о клиенте - только результаты анализов

Доработанные DF-диаграммы с инструментами и способами, позволяющими обеспечить конфиденциальность данных в потоках:
[DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD2.drawio)
![DFD.drawio](https://github.com/Boropwnz/architecture-medikamente/blob/medikamente/Task1/DFD2.svg)

